tags:
[gcloud](https://github.com/search?q=user%3Abaikulov+repo%3Abaikulov%2Finstructions+tags%3A+gcloud+in%3Afile&type=code),
[instances](https://github.com/search?q=user%3Abaikulov+repo%3Abaikulov%2Finstructions+tags%3A+instances+in%3Afile&type=code)
# Как настроить проект для работы с системными переменными

Во время работы с одинаковыми файлами в разных проектах часто приходится менять значения различных credentials. Это не всегда очень удобно, потому что таких файлов много, и где-то можно забыть заменить значение. Поэтому нужен удобный способ быстро установить нужные значения и не пропустить ни одного файла.

### Используем системные переменные
Для того, чтобы перейти к использованию глобальных переменных, сначала их нужно указать в вашем коде. Например: 
```R
# старый вариант
credentials = 'gcp_login@gmail.com'

# новый вариант
credentials = Sys.getenv('PROJECT_GCP_CREDENTIALS')

```

Новый вариант позволит быстро развернуть этот же файл в другом месте. Но чтобы в переменную подтянулись корректные значения нужно их сперва указать.

### Устанавливаем значения для переменных

Первоначально я ставил переменные через команду 

```bash
export PROJECT_GCP_CREDENTIALS='gcp_login@gmail.com'
```

Но это очень долго и не удобно, и почти ничем не отличается от ручной смены значений при переключении проекта. Поэтому пришлось поискать более удобное решение.
На текущйи момент лучшее и единственное, что мне известно это python-библиотеки **virtualenv** и **virtualenvwrapper**. Первая позволяет использовать виртуальное окружение, а вторая обогащает виртуальное окружение файлами **postactivate** и **postdeactivate**

Именно такое сочетание ползволяет переключаться между проектами без замены значений для переменных вручную

### Как это работает

1. Первоначально ставим библиотеки

```bash
# ставим бибблиотеки
pip3 install virtualenv
pip3 install virtualenvwrapper

# проверяем их наличие в нашем списке python библиотек
pip3 list
```

2. Затем устанавливаем специальную переменную WORKON_HOME. В ней мы указываем путь к папке, в которой будут лежать все созданные виртуальыне окружения

```bash
# задаём значение для переменной
export WORKON_HOME=$HOME/.virtualenvs

# затем запускаем sh скрипт для окончательной установки virtualenvwrapper
source /usr/local/bin/virtualenvwrapper.sh
```

3. Теперь мы можем создавать виртуальные окружения. Делается это очень просто

```bash
# создаём виртуальное окружение
mkvirtualenv my_env_example_name

# запускаем виртуальное окружение
workon my_env_example_name

# деактивируем
deactivate
```

4. Основная идея в том, что когда вы активируете виртуальное окружение, в глобальном окружении создаются нужные вам переменные с нужными значениями. А после деактивации - они удаляются.

За создание переменных отвечает файл **postactivate**. У каждого виртуального окружения он свой. Нужно зайти в $HOME/.virtualenvs/my_env_example_name/bin/ и отредактировать файл, добавив туда код

```bash
#!/bin/bash
set -a
# указываем путь к файлу, в котором укажем наши переменные
source $HOME/path_toEnv_file/.env
set +a
```

А для удаления переменных отредактируем второй файл **postdeactivate**

```bash
#!/bin/bash

# так же указываем путь к файлу с переменными для функции cat. А функция unset удалит переменные
unset $(cat $HOME/path_toEnv_file/.env | grep -oP "^.*(?=\=)")
```

5. Осталось только создать наш файл с переменными. Создаём файл .env в папке нашего проекта, где ведём разработку. Добавляем этот файл в .gitIgnore.
Указываем в файле в виде пары ключ=значение

```bash
MY_VAR='value'
MY_VAR_2='value_2'
MY_VAR_3='value_3'

```

Теперь при создании нового проекта нам нужно просто создать файл с переменными и запустить виртуальное окружение. А значения подтянутся автоматически.